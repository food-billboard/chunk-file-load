(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[5],{"/7QA":function(e,t,r){"use strict";r.r(t);var n=r("QG5f");r.d(t,"Upload",(function(){return n["a"]}));var a=r("bpEk");r.d(t,"WeUpload",(function(){return a["a"]}));var i=r("GnCH");for(var s in i)["default","Upload","WeUpload","ECACHE_STATUS","EActionType"].indexOf(s)<0&&function(e){r.d(t,e,(function(){return i[e]}))}(s);var u=r("f/wd");r.d(t,"ECACHE_STATUS",(function(){return u["b"]})),r.d(t,"EActionType",(function(){return u["a"]}))},GnCH:function(e,t){},QG5f:function(e,t,r){"use strict";r.d(t,"a",(function(){return K}));var n=r("k1fw"),a=r("tJVT"),i=r("PpiC"),s=r("9og8"),u=r("WmNS"),c=r.n(u),o=r("LvDl"),l=r("uhBA"),f=r.n(l),d=r("f/wd"),h={pending:[d["b"].waiting,d["b"].pending],waiting:[d["b"].waiting,d["b"].reading,d["b"].rejected,d["b"].cancel,d["b"].stopping,(e,t)=>e===d["b"].uploading&&t.tool.file.isParseIgnore()],reading:[d["b"].reading,d["b"].cancel,d["b"].rejected,d["b"].stopping,d["b"].uploading],uploading:[d["b"].rejected,d["b"].stopping,d["b"].cancel,d["b"].uploading,d["b"].fulfilled],fulfilled:[],rejected:[d["b"].rejected,d["b"].pending],cancel:[d["b"].rejected],stopping:[d["b"].stopping,d["b"].pending]},p=(e,t,r)=>r.some((r=>"number"===typeof r?r===e:r(e,t))),v={[d["b"].pending](e,t){var r=p(e,t,h.pending);return r?e:void 0},[d["b"].waiting](e,t){var r=p(e,t,h.waiting);return r?e:void 0},[d["b"].reading](e,t){var r=p(e,t,h.reading);return r?e:void 0},[d["b"].uploading](e,t){var r=p(e,t,h.uploading);return r?e:void 0},[d["b"].fulfilled](e,t){var r=p(e,t,h.fulfilled);return r?e:void 0},[d["b"].stopping](e,t){var r=p(e,t,h.stopping);return r?e:void 0},[d["b"].cancel](e,t){var r=p(e,t,h.cancel);return r?e:void 0},[d["b"].rejected](e,t){var r=p(e,t,h.rejected);return r?e:void 0}},b=e=>t=>Object.prototype.toString.call(t)==="[object ".concat(e,"]"),g=(b("Number"),b("Object")),m=(b("Array"),b("File"),b("Blob"),b("Function"),b("Symbol"),b("ArrayBuffer"),e=>"string"===typeof e&&/([a-f\d]{32}|[A-F\d]{32})/.test(e)),k=e=>"string"===typeof e&&(/^\s*data:([a-z]+\/[a-z0-9-+.]+(;[a-z-]+=[a-z0-9-]+)?)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s]*?)\s*$/i.test(e)||/^([A-Za-z0-9+/]{4})*([A-Za-z0-9+/]{4}|[A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)$/.test(e)),w=e=>{if(!k(e))return 0;var t=e.split(",");t=1==t.length?t[0]:t[1];var r=t.indexOf("=");t.indexOf("=")>0&&(t=t.substring(0,r));var n=t.length;return parseInt((n-n/8*2).toString())},x=e=>{if(!Array.isArray(e))return e;if(e.flat)return e.flat(1/0);var t=[];return e.forEach((e=>{if(Array.isArray(e)){var r=x(e);t=[...t,...r]}else t.push(e)})),t};function y(e){return e?0==e.length?Promise.resolve(e):new Promise((t=>{for(var r=e.length,n=0,a=[],i=0;i<r;i++)Promise.resolve(e[i]).then((function(e){if(n++,a.push({status:"fulfilled",value:e}),n==r)return t(a)}),(function(e){if(n++,a.push({status:"rejected",reason:e}),n==r)return t(a)}))})):Promise.reject("params is not array")}var j=e=>{var t;if(!k(e))throw new Error("the params is not a base64 type");for(var r=e.replace(/^data:.+?\/.+;base64,/,""),n="undefined"!==typeof window?window.atob(r):null===(t=atob)||void 0===t?void 0:t(r),a=new Uint8Array(n.length),i=0;i<n.length;++i)a[i]=n.charCodeAt(i);return a.buffer},O=e=>{var t="",r=new Uint8Array(e),n=r.length;if(n>512e3)throw new Error("buffer is too large");for(var a=0;a<n;a++)t+=String.fromCharCode(r[a]);return btoa(t)};function E(e){return Object(s["default"])(c.a.mark((function t(){var r,n=arguments;return c.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e(...n);case 3:return r=t.sent,t.abrupt("return",[null,r]);case 7:return t.prev=7,t.t0=t["catch"](0),t.abrupt("return",[t.t0,null]);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))}class C{constructor(e){this.getTask=void 0,this.getTask=e}get file(){return this.getTask()}isParseIgnore(){var e;return this.isParseIgnoreConfig()||this.isMd5(null===(e=this.file)||void 0===e?void 0:e.file.md5)}isParseIgnoreConfig(){var e;return!(null===(e=this.file)||void 0===e||!e.config.parseIgnore)}isMd5(e){return!!e&&!!m(e)}isExitFnEmit(){var e,t;return!(null!==(e=this.file)&&void 0!==e&&e.config.parseIgnore)&&"function"===typeof(null===(t=this.file)||void 0===t?void 0:t.request.exitDataFn)}isTaskValid(e){return!!g(e)&&(!!(null!==e&&void 0!==e&&e.file||null!==e&&void 0!==e&&e.chunks)||(console.warn("the params is not verify"),!1))}isTaskDeal(e){var t=this.getStatus(e);return t===d["b"].pending}isTaskCancelAdd(e){var t=this.getStatus(e);return t===d["b"].pending}isTaskStopOrCancel(e){var t=this.getStatus(e);return t>d["b"].pending&&t<d["b"].fulfilled}isChunkComplete(e){var t,r,n,a,i,s,u,c,o=null!==(t=null===e||void 0===e?void 0:e.file.chunks)&&void 0!==t?t:null===(r=this.file)||void 0===r?void 0:r.file.chunks,l=null!==(n=null===e||void 0===e?void 0:e.file.size)&&void 0!==n?n:null===(a=this.file)||void 0===a?void 0:a.file.size,f=null!==(i=null===e||void 0===e?void 0:e.config.chunkSize)&&void 0!==i?i:null===(s=this.file)||void 0===s?void 0:s.config.chunkSize,d=Math.ceil(l/f)||0,h=null!==(u=null===e||void 0===e?void 0:e.file.mime)&&void 0!==u?u:null===(c=this.file)||void 0===c?void 0:c.file.mime;return Array.isArray(o)&&!!o.length&&(!l||o.length===d)&&!!h}isFileUploadStart(e){var t=this.getStatus(e);return t===d["b"].reading||t===d["b"].uploading||t===d["b"].rejected||t===d["b"].stopping}getStatus(e){var t,r;return null!==(t=null===e||void 0===e?void 0:e.status)&&void 0!==t?t:null===(r=this.file)||void 0===r?void 0:r.status}isStop(e){var t=this.getStatus(e);return t===d["b"].stopping}isCancel(e){var t=this.getStatus(e);return t===d["b"].cancel}isPending(e){var t=this.getStatus(e);return t===d["b"].pending}isRejected(e){var t=this.getStatus(e);return t===d["b"].rejected}getFileType(e){var t=Object(o["get"])(this.file,"file.mime"),r=Object(o["get"])(e,"file.mime"),n=Object(o["get"])(this.file,"file.file.type"),a=Object(o["get"])(e,"file.file.type");return a||n||r||t}isTaskComplete(e){var t=this.getStatus(e);return t===d["b"].fulfilled}isTaskDealing(e){var t=this.getStatus(e);return t>d["b"].pending&&t<d["b"].fulfilled}isTaskRequestCache(e){return!!(e||this.file).config.requestCache}}var S=function(e){var t=e();return Object(o["merge"])({},t||{},{tool:{file:new C(e)}})};class T{constructor(e){var t=this;this.context=void 0,this.tasks=[],this.lifecycleBinding=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=Object.entries(e);return r.reduce(((e,r)=>{var n=Object(a["default"])(r,2),i=n[0],s=n[1];return e[i]=s.bind(t.context),e}),{})},this.requestBinding=e=>{var t=Object.entries(e);return t.reduce(((e,t)=>{var r=Object(a["default"])(t,2),n=r[0],i=r[1];return e[n]=null===i||void 0===i?void 0:i.bind(this.context),e}),{})},this.customerMergeMethod=(e,t)=>{if(Array.isArray(e)&&Array.isArray(t))return Object(o["mergeWith"])(e.slice(0,t.length),t,this.customerMergeMethod)},this.setState=function(e){var r,n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],u=t.getTask(e),c=Object(a["default"])(u,2),l=c[0],f=c[1],d=null===f||void 0===f?void 0:f.status,h=i.status;s?r="number"===typeof h?h:d:r="number"===typeof h&&null!==(n=v[d](h,f))&&void 0!==n?n:d;return t.tasks[l]=Object(o["mergeWith"])(f,i,{status:r},t.customerMergeMethod),t.tasks[l]},this.context=e}getTask(e){var t=this.tasks.findIndex((t=>t.symbol===e));return~t?[t,this.tasks[t]]:[-1,null]}getTasks(){return this.tasks}resumeTask(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=t.reduce(((e,t)=>{var r=t.symbol,n=t.tool,a=t.file;if(n.file.isTaskValid(a)){if(this.getTask(r)[1])return console.warn("the task is uploading",r),e;e.push(r),this.tasks.push(t),this.setState(r,{process:{total:0,complete:0,current:0},status:d["b"].pending},!0)}else console.warn("the task is not valid and be ignore: ",r);return e}),[]);return n}FILE_TYPE(e){var t,r,n,i,s=e.file,u=e.mime,c=Object.prototype.toString.call(s);try{var l=c.match(/(?<=\[object ).+(?=\])/)||[],f=Object(a["default"])(l,1);c=f[0]}catch(p){c=c.replace("[object ","").replace("]","")}c=c.toLowerCase().trim();var h=Object(o["merge"])({size:0,name:"",file:s||null,action:d["a"].MD5},e);switch(c){case"file":h=Object(o["merge"])(h,{size:null!==(t=null===s||void 0===s?void 0:s.size)&&void 0!==t?t:0,name:null!==(r=null===s||void 0===s?void 0:s.name)&&void 0!==r?r:null,action:d["a"].FILE,mime:u||s.type});break;case"blob":h=Object(o["merge"])(h,{size:null!==(n=null===s||void 0===s?void 0:s.size)&&void 0!==n?n:0,action:d["a"].FILE});break;case"arraybuffer":h=Object(o["merge"])(h,{size:null!==(i=null===s||void 0===s?void 0:s.byteLength)&&void 0!==i?i:0,action:d["a"].BUFFER});break;case"string":h=Object(o["merge"])(h,{size:w(s),action:d["a"].BASE64});break;default:}return h}generateTask(e,t){var r=e.config,n=void 0===r?{}:r,a=e.file,s=e.lifecycle,u=e.request,c=Object(i["a"])(e,["config","file","lifecycle","request"]),l=Object(d["c"])(Object(o["merge"])({},this.context.defaultConfig,n));return Object(o["merge"])(c,{request:this.requestBinding(u),process:{current:0,complete:0,total:0},lifecycle:this.lifecycleBinding(s||{}),file:this.FILE_TYPE(a),config:l,symbol:t,status:d["b"].pending})}add(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(!t.length)return[];var n=[],i=x(t).reduce(((e,t)=>{var r=t.file,i=Symbol(Date.now().toString()),s=S((()=>{var e=this.getTask(i),t=Object(a["default"])(e,2),r=t[1];return r}));return s=Object(o["merge"])({},s,t),s.tool.file.isTaskValid(r)&&(s=this.generateTask(s,i),s.tool.file.isChunkComplete(s)&&(Object(o["set"])(s,"file._cp_",!0),Object(o["set"])(s,"file.action",d["a"].MD5)),Object(o["set"])(s,"tool.requestCache",{exitDataFn:null,completeFn:null,uploadFn:null}),e.push(s),n.push(s.symbol)),e}),[]);return this.tasks.push(...i),n}deal(){for(var e=[],t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return r.forEach((t=>{var r=this.getTask(t),n=Object(a["default"])(r,2),i=n[0],s=n[1];null!==s&&void 0!==s&&s.tool.file.isTaskDeal()&&(null===s||void 0===s?void 0:s.symbol)===t&&(this.statusChange(d["b"].waiting,i),e.push(s))})),e}statusChange(e,t){if("number"===typeof t)this.tasks[t].status=e;else{var r=this.getTask(t),n=Object(a["default"])(r,2),i=n[0],s=n[1];this.tasks[i]=Object(o["merge"])(s,{status:e})}}dealDoingTaskStatus(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return r.reduce(((t,r)=>{var n=this.getTask(r),i=Object(a["default"])(n,2),s=i[0],u=i[1];return u&&u.tool.file.isTaskStopOrCancel()&&(t.push(r),this.statusChange(e,s)),t}),[])}stop(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.dealDoingTaskStatus(d["b"].stopping,...t)}cancel(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.dealDoingTaskStatus(d["b"].cancel,...t)}cancelAdd(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=this.tasks,a=n.filter((e=>e.tool.file.isTaskCancelAdd(e)&&t.includes(e.symbol)));return a.length?this.off(...a.map((e=>e.symbol))):[]}off(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=this.tasks;if(!t.length){var a=n.map((e=>e.symbol));return this.clean(),a}return this.tasks=this.tasks.filter((e=>!t.includes(e.symbol))),t}clean(){this.tasks=[]}}var A={on:-1,addListener:-1,off:0,once:1,removeListener:0},F={key:"_internal_lifecycle_",counter:-1};class P{constructor(){var e=this;this.lifecycleMap=void 0,this.emit=function(){var t=Object(s["default"])(c.a.mark((function t(r,n){var a,i,s,u,l,f,d,h,p,v;return c.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:a=e.lifecycleMap[r],i=!1,s={},u=n.name,l=0;case 5:if(!(l<a.length)){t.next=29;break}if(f=a[l],d=f.key,h=f.counter,p=f.action,"symbol"!==typeof d||d===u){t.next=9;break}return t.abrupt("continue",26);case 9:return v={},~h&&a[l].counter--,0==h&&(a[l].skip=!0),t.prev=12,t.next=15,p(n,s);case 15:v=t.sent,t.next=23;break;case 18:return t.prev=18,t.t0=t["catch"](12),i=t.t0,"object"===typeof i&&(v=Object(o["merge"])(v,Object(o["omit"])(i,["error"]))),t.abrupt("break",29);case 23:return t.prev=23,s=Object(o["merge"])({},s,v instanceof Object?v:{}),t.finish(23);case 26:l++,t.next=5;break;case 29:if(a=a.filter((e=>!e.skip)),!i){t.next=32;break}return t.abrupt("return",Promise.reject(i));case 32:return t.abrupt("return",Promise.resolve(s));case 33:case"end":return t.stop()}}),t,null,[[12,18,23,26]])})));return function(e,r){return t.apply(this,arguments)}}(),this.init()}init(){this.lifecycleMap={beforeRead:[],reading:[Object(o["merge"])({},F,{action(e){var t=e.current,r=e.total;return{process:{current:t,complete:t,total:r}}}})],beforeCheck:[Object(o["merge"])({},F,{action(e){var t=e.task,r=Math.ceil(t.process.total/t.config.chunkSize);return{process:{current:0,complete:0,total:r}}}})],afterCheck:[],uploading:[Object(o["merge"])({},F,{action(e){var t=e.current,r=e.total,n=e.complete;return{process:{current:t,total:r,complete:n}}}})],afterCancel:[],afterComplete:[],beforeComplete:[Object(o["merge"])({},F,{action(e){var t=e.task,r=Math.ceil(t.file.size/t.config.chunkSize);return{process:{current:r,total:r,complete:r}}}})],afterStop:[],retry:[Object(o["merge"])({},F,{action(e){var t=e.rest;return{config:{retry:{times:t}}}}})]}}wrapper(e,t){return function(){var e=Object(s["default"])(c.a.mark((function e(r,n){var a,i,s,u;return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a={error:!1},e.prev=1,e.next=4,t(r,n);case 4:i=e.sent,0==i&&(a=Object(o["merge"])(a,{status:d["b"].stopping})),e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](1),a.error=!0;case 11:if(e.prev=11,s=a,u=s.error,!u){e.next=15;break}return e.abrupt("return",Promise.reject(a));case 15:return e.abrupt("return",Promise.resolve(a));case 17:case"end":return e.stop()}}),e,null,[[1,8,11,17]])})));return function(t,r){return e.apply(this,arguments)}}()}onWithObject(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"on";Object.entries(e).forEach((e=>{var n=Object(a["default"])(e,2),i=n[0],s=n[1];this.on(i,s,t,r)}))}onWithArray(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"on";e.forEach((e=>{this.onWithObject(e,t,r)}))}on(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"on";if("string"===typeof e&&"function"===typeof t&&this.lifecycleMap[e]){var a=this.lifecycleMap[e].findIndex((e=>e.key==r));if("off"===n||"removeListener"===n){if(!~a)return;this.lifecycleMap[e].splice(a,1)}else{var i={key:r,action:this.wrapper(e,t),counter:A[n]};~a?this.lifecycleMap[e].splice(a,1,i):this.lifecycleMap[e].push(i)}}}}var L=r("aaBP"),B=class{constructor(e){this.context=void 0,this.emit=void 0,this.dealLifecycle=void 0,this.setState=void 0,this.getState=void 0,this.hasReaderEmit=()=>this.hasEmit("reader"),this.hasSliceEmit=()=>this.hasEmit("slicer"),this.hasEmit=e=>this.context.eventNames().includes(e),this.context=e,this.init()}init(){this.emit=this.context.emit.bind(this.context),this.dealLifecycle=this.context.LIFECYCLE_EMIT.bind(this.context),this.setState=this.context.emitter.setState.bind(this.context.emitter),this.getState=this.context.emitter.getTask.bind(this.context.emitter)}};class q{constructor(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.value=void 0,this.next=void 0,this.value=e,this.next=t}toString(e){return e?e(this.value):"".concat(this.value)}}class I{constructor(e){this.compare=I.defaultCompareFunction,this.compare=e||I.defaultCompareFunction}static defaultCompareFunction(e,t){return e===t?0:e<t?-1:1}equal(e,t){return 0===this.compare(e,t)}lessThan(e,t){return this.compare(e,t)<0}greaterThan(e,t){return this.compare(e,t)>0}lessThanOrEqual(e,t){return this.lessThan(e,t)||this.equal(e,t)}greaterThanOrEqual(e,t){return this.greaterThan(e,t)||this.equal(e,t)}reverse(){var e=this.compare;this.compare=(t,r)=>e(r,t)}}var M;class _{constructor(e){this.tail=void 0,this.head=void 0,this.compare=void 0,this.head=null,this.tail=null,this.compare=new I(e)}prepend(e){var t=new q(e,this.head);return this.head=t,this.tail||(this.tail=t),this}append(e){var t=new q(e);return this.head?(this.tail.next=t,this.tail=t,this):(this.head=t,this.tail=t,this)}delete(e){if(!this.head)return null;var t=null;while(this.head&&this.compare.equal(this.head.value,e))t=this.head,this.head=this.head.next;var r=this.head;if(null!==r)while(r.next)this.compare.equal(r.next.value,e)?(t=r.next,r.next=r.next.next):r=r.next;return this.compare.equal(this.tail.value,e)&&(this.tail=r),t}find(e){var t=e.value,r=void 0===t?void 0:t,n=e.callback,a=void 0===n?void 0:n;if(!this.head)return null;var i=this.head;while(i){if(a&&a(i.value))return i;if(void 0!==r&&this.compare.equal(i.value,r))return i;i=i.next}return null}deleteTail(){var e=this.tail;if(this.head===this.tail)return this.head=null,this.tail=null,e;var t=this.head;while(null!==(r=t)&&void 0!==r&&r.next){var r;t.next.next?t=t.next:t.next=null}return this.tail=t,e}deleteHead(){if(!this.head)return null;var e=this.head;return this.head.next?this.head=this.head.next:(this.head=null,this.tail=null),e}fromArray(e){return e.forEach((e=>this.append(e))),this}toArray(){var e=[],t=this.head;while(t)e.push(t),t=t.next;return e}toString(e){return this.toArray().map((t=>t.toString(e))).toString()}reverse(){var e=this.head,t=null,r=null;while(e)r=e.next,e.next=t,t=e,e=r;return this.tail=this.head,this.head=t,this}}class z{constructor(){this.linkedList=void 0,this.linkedList=new _}isEmpty(){return!this.linkedList.head}peek(){return this.linkedList.head?this.linkedList.head.value:null}enqueue(e){this.linkedList.append(e)}dequeue(){var e=this.linkedList.deleteHead();return e?e.value:null}find(e){var t=e.value,r=void 0===t?void 0:t,n=e.callback,a=void 0===n?void 0:n;return this.linkedList.find({value:r,callback:a})}toString(e){return this.linkedList.toString(e)}}class D{constructor(){this.spark=void 0,this.uploader=void 0,this.cache=[],this.generateCacheChunk=e=>"undefined"===typeof Blob?e:new Blob([e]),this.init()}static support(){try{return!("undefined"==typeof Worker)}catch(e){return!1}}ping(){return"pong"}init(){this.spark=new L["ArrayBuffer"],this.cache=[]}read(e){this.spark.append(e),this.cache&&this.cache.push(this.generateCacheChunk(e))}readEnd(){return this.spark.end()}getChunk(e){return this.cache[e]}clean(){this.init()}close(){D.support()}cacheExists(e){return!!this.cache.length&&("number"!==typeof e||this.cache.length===e)}}var R=1e4;class U{static getProcess(e){return e&&U.process.find((t=>t.id==e))||null}static getProcesses(){return U.process}static inspectThreads(){return Object(s["default"])(c.a.mark((function e(){var t,r,n,a;return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!(U.process.length>0)){e.next=11;break}t=0;case 2:if(!(t<U.process.length)){e.next=11;break}return n=U.process[t],e.next=6,null===(r=n.worker)||void 0===r?void 0:r.ping();case 6:a=e.sent,"pong"!=a&&U.worker_clean(n.id);case 8:t++,e.next=2;break;case 11:case"end":return e.stop()}}),e)})))()}static initProcessPool(){return"number"!==typeof U.inspectTimer&&(U.inspectTimer=setInterval(U.inspectThreads,R)),new Array(U.PROCESS_LIMIT).fill(0).map(((e,t)=>({id:t+"",busy:!1})))}static createThread(e){return Object(s["default"])(c.a.mark((function t(){var r,n;return c.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r={id:e,busy:!1},n=()=>{r=Object(o["merge"])(r,{worker:new D,release:o["noop"]})},n(),t.abrupt("return",r);case 4:case"end":return t.stop()}}),t)})))()}enqueue(){var e=arguments,t=this;return Object(s["default"])(c.a.mark((function r(){var n,a,i;return c.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:for(n=e.length,a=new Array(n),i=0;i<n;i++)a[i]=e[i];return a.forEach((e=>{U.QUEUE.enqueue(e)})),r.abrupt("return",t.taskDeal());case 3:case"end":return r.stop()}}),r)})))()}dequeue(){return U.QUEUE.dequeue()||null}static queueIsEmpty(){return U.QUEUE.isEmpty()}static isBusy(e){if(e){var t=U.process.find((t=>(null===t||void 0===t?void 0:t.id)==e));return!(null===t||void 0===t||!t.busy)}return!(U.process.length<U.PROCESS_LIMIT)&&U.process.every((e=>e.busy))}static getUnBusyProcess(){return U.process.filter((e=>!e.busy&&!e.task))}static setProcessInfo(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.id,a=U.process.findIndex((e=>e.id===r));return~a&&(e=Object(n["a"])(Object(n["a"])({},U.process[a]),t),U.process[a]=e),e}taskDeal(){var e=this;return Object(s["default"])(c.a.mark((function t(){var r,n,a,i,s,u,l,f,d;return c.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!(U.queueIsEmpty()||U.isBusy()||U.dealLoading)){t.next=2;break}return t.abrupt("return",[]);case 2:U.dealLoading=!0,r=[],n=U.getUnBusyProcess(),a=0;case 6:if(!(a<n.length)){t.next=22;break}if(!U.queueIsEmpty()){t.next=9;break}return t.abrupt("break",22);case 9:if(i=e.dequeue(),s=n[a],u=s.worker,l=s.id,f=Object(o["merge"])(n[a],{busy:!1,task:i}),u){t.next=17;break}return t.next=15,U.createThread(l);case 15:d=t.sent,f=Object(o["merge"])(d,{busy:!0});case 17:U.setProcessInfo(f),r.push(f.id);case 19:a++,t.next=6;break;case 22:return U.dealLoading=!1,t.abrupt("return",r);case 24:case"end":return t.stop()}}),t)})))()}static worker_clean(e){var t,r,a=U.getProcess(e),i={id:e,busy:!1,task:void 0};U.queueIsEmpty()?(null===a||void 0===a||null===(t=a.worker)||void 0===t||t.close(),(null===a||void 0===a?void 0:a.release)&&(null===a||void 0===a||a.release()),i=Object(n["a"])(Object(n["a"])({},i),{},{release:o["noop"],worker:null})):null===a||void 0===a||null===(r=a.worker)||void 0===r||r.clean();U.setProcessInfo(i)}}U.dealLoading=!1,U.QUEUE=new z,U.PROCESS_LIMIT="undefined"!==typeof window&&(null===(M=window)||void 0===M?void 0:M.navigator.hardwareConcurrency)||4,U.inspectTimer=void 0,U.process=U.initProcessPool();var N=U;class G extends B{constructor(e,t,r){super(e),this.file=void 0,this.task=void 0,this.task=t,r&&(this.file=r)}error(e){return Promise.reject(e)}pluginEmit(e){var t=arguments,r=this;return Object(s["default"])(c.a.mark((function n(){var a,i,s;return c.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:for(a=t.length,i=new Array(a>1?a-1:0),s=1;s<a;s++)i[s-1]=t[s];if(!r.hasSliceEmit()){n.next=5;break}return n.abrupt("return",new Promise(((e,t)=>{r.emit("slicer",r.task,...i,((r,n)=>{r?t(r):e(n)})),setTimeout((()=>{t("timeout")}),864e5)})));case 5:return n.abrupt("return",e(...i));case 6:case"end":return n.stop()}}),n)})))()}}var W=class extends G{constructor(e,t,r){var n,a,i=()=>super.error,u=arguments.length>3&&void 0!==arguments[3]&&arguments[3];super(e,t,r),n=this,this.slicer=void 0,this.returnBlob=!1,this.fileReader=void 0,this._slice=function(){var e=Object(s["default"])(c.a.mark((function e(t){var r,a,s,u,o=arguments;return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=o.length>1&&void 0!==o[1]?o[1]:null===(r=n.file)||void 0===r?void 0:r.size,s=o.length>2?o[2]:void 0,void 0!=n.fileReader){e.next=4;break}return e.abrupt("return",Promise.reject("this environment is not support the FileReader api"));case 4:if(u=n.slicer.call(n.file||s,t,a),!n.returnBlob){e.next=7;break}return e.abrupt("return",Promise.resolve(u));case 7:return e.abrupt("return",new Promise(((e,t)=>{n.fileReader.onload=function(r){if(!r.target)return t("\u8bfb\u53d6\u9519\u8bef");e(r.target.result)},n.fileReader.onerror=i(),n.fileReader.readAsArrayBuffer(u)})));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.slice=function(){var e=Object(s["default"])(c.a.mark((function e(t){var r,a,i,s,u,o,l=arguments;return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=l.length>1&&void 0!==l[1]?l[1]:null===(r=n.file)||void 0===r?void 0:r.size,i=l.length>2&&void 0!==l[2]?l[2]:n.file,s=null!==t&&void 0!==t?t:0,u=null!==i&&void 0!==i?i:n.file,o=null!==a&&void 0!==a?a:u.size,e.abrupt("return",n.pluginEmit(n._slice,s,o,u));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.returnBlob=u,this.slicer=null===(a=Blob)||void 0===a?void 0:a.prototype.slice,"undefined"!=typeof FileReader&&(this.fileReader=new FileReader)}},Q=class extends G{constructor(){var e;super(...arguments),e=this,this.slicer=ArrayBuffer.prototype.slice,this.slice=function(){var t=Object(s["default"])(c.a.mark((function t(r){var n,a,i,s,u,o,l=arguments;return c.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=l.length>1&&void 0!==l[1]?l[1]:null===(n=e.file)||void 0===n?void 0:n.byteLength,i=l.length>2?l[2]:void 0,s=null!==r&&void 0!==r?r:0,u=null!==i&&void 0!==i?i:e.file,o=null!==a&&void 0!==a?a:u.byteLength,t.abrupt("return",e.pluginEmit(e._slice,s,o,u));case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),this._slice=function(){var t=Object(s["default"])(c.a.mark((function t(r){var n,a,i,s=arguments;return c.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=s.length>1&&void 0!==s[1]?s[1]:null===(n=e.file)||void 0===n?void 0:n.byteLength,i=s.length>2?s[2]:void 0,t.abrupt("return",Promise.resolve(e.slicer.call(e.file||i,r,a)));case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}},H=class extends G{constructor(e,t){var r;super(e,t),r=this,this.slicer=void 0,this.slice=function(){var e=Object(s["default"])(c.a.mark((function e(t,n,a){var i,s,u;return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=null!==t&&void 0!==t?t:0,s=K.atob(a),u=null!==n&&void 0!==n?n:s.byteLength,e.abrupt("return",r.slicer.slice(i,u,s));case 4:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),this.slicer=new Q(e,t)}},Y=class{constructor(e,t){this.arraybuffer=void 0,this.base64=void 0,this.blob=void 0,this.base64=new H(e,t),this.blob=new W(e,t),this.arraybuffer=new Q(e,t)}slice(e,t,r){var n=this;return Object(s["default"])(c.a.mark((function a(){var i,s;return c.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(i=t||0,s=r,"string"!==typeof e){a.next=6;break}return a.abrupt("return",n.base64.slice(i,s,e));case 6:if("[object ArrayBuffer]"!==Object.prototype.toString.call(e)){a.next=10;break}return a.abrupt("return",n.arraybuffer.slice(i,s,e));case 10:if(!(e instanceof File||e instanceof Blob)){a.next=12;break}return a.abrupt("return",n.blob.slice(i,s,e));case 12:return console.log(e,11111111),a.abrupt("return",Promise.reject("the file type is not support"));case 14:case"end":return a.stop()}}),a)})))()}};var V=class extends B{constructor(e,t){super(e),this.worker=void 0,this.worker=N.getProcess(t)}workerExists(){return!!this.worker}read(e){var t=this;return Object(s["default"])(c.a.mark((function r(){return c.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.abrupt("return",t.worker.worker.read(e));case 1:case"end":return r.stop()}}),r)})))()}readEnd(){var e=this;return Object(s["default"])(c.a.mark((function t(){return c.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",e.worker.worker.readEnd());case 1:case"end":return t.stop()}}),t)})))()}sparkMethod(){var e=this.workerExists(),t=this;if(e){var r=new L["ArrayBuffer"];return function(){var e=Object(s["default"])(c.a.mark((function e(t,n){var a,i,s;return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=n.next,i=n.done,r.append(t),!a){e.next=7;break}return e.next=5,a();case 5:e.next=8;break;case 7:i&&(s=r.end(),r.destroy(),i(s));case 8:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()}return function(){var e=Object(s["default"])(c.a.mark((function e(r,n){var a,i,s,u;return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=n.next,i=n.done,s=n.error,e.prev=1,e.next=4,t.read(r);case 4:e.next=9;break;case 6:return e.prev=6,e.t0=e["catch"](1),e.abrupt("return",s(e.t0));case 9:if(!a){e.next=14;break}return e.next=12,a();case 12:e.next=19;break;case 14:if(!i){e.next=19;break}return e.next=17,t.readEnd();case 17:u=e.sent,i(u);case 19:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(t,r){return e.apply(this,arguments)}}()}blob(e){var t=this;return Object(s["default"])(c.a.mark((function r(){var n,a,i,u,o,l,f,h,p;return c.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.file,a=n.size,i=n.file,u=e.config.chunkSize,o=e.symbol,l=t,f=0,h=Math.ceil(a/u),p=new W(t.context,e,i),r.abrupt("return",new Promise(function(){var e=Object(s["default"])(c.a.mark((function e(t,r){var n,i,v;return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return v=function(){return v=Object(s["default"])(c.a.mark((function e(){var s,v,b,g,m,k;return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return s=f*u,v=f+1===h?a:(f+1)*u,e.prev=1,e.next=4,p.slice(s,v);case 4:return b=e.sent,e.next=7,l.dealLifecycle("reading",{name:o,status:d["b"].reading,current:v,total:a});case 7:return g=!1,m=!1,k=r,++f<h?g=i:m=t,e.next=13,n(b,{next:g,done:m,error:k});case 13:e.next=18;break;case 15:e.prev=15,e.t0=e["catch"](1),r(e.t0);case 18:case"end":return e.stop()}}),e,null,[[1,15]])}))),v.apply(this,arguments)},i=function(){return v.apply(this,arguments)},n=l.sparkMethod(),e.next=5,i();case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()));case 5:case"end":return r.stop()}}),r)})))()}arraybuffer(e){var t=this;return Object(s["default"])(c.a.mark((function r(){var n,a,i,u,o,l,f,h,p,v;return c.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=t,a=e.file,i=a.size,u=a.file,o=e.config.chunkSize,l=e.symbol,f=0,h=Math.ceil(i/o),p=t.sparkMethod(),v=new Q(t.context,e,u),r.abrupt("return",new Promise(function(){var e=Object(s["default"])(c.a.mark((function e(t,r){var a,u;return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return u=function(){return u=Object(s["default"])(c.a.mark((function e(){var s,u,b,g,m,k;return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return s=f*o,u=f+1===h?i:(f+1)*o,e.prev=1,e.next=4,v.slice(s,u);case 4:return b=e.sent,e.next=7,n.dealLifecycle("reading",{name:l,status:d["b"].reading,current:u,total:i});case 7:return g=!1,m=!1,k=r,++f<h?g=a:m=t,e.next=13,p(b,{next:g,done:m,error:k});case 13:e.next=18;break;case 15:e.prev=15,e.t0=e["catch"](1),r(e.t0);case 18:case"end":return e.stop()}}),e,null,[[1,15]])}))),u.apply(this,arguments)},a=function(){return u.apply(this,arguments)},e.next=4,a();case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()));case 5:case"end":return r.stop()}}),r)})))()}base64(e){var t=this;return Object(s["default"])(c.a.mark((function r(){var n,a;return c.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.file,a=K.atob(n.file),r.abrupt("return",t.arraybuffer(Object(o["merge"])(e,{file:Object(o["merge"])(n,{file:a})})));case 3:case"end":return r.stop()}}),r)})))()}files(e){var t=this;return Object(s["default"])(c.a.mark((function r(){var n,a,i,u,l,f,h,p,v,b,g,m,k,w;return c.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=t,a=e.file,i=a.chunks,a.md5,u=a.size,l=e.symbol,f=e.config.chunkSize,h=e.tool,p=0,v=i.length,b=0,g=new Y(t.context,e),m="number"===typeof u&&u>0?u:f*i.length,k=0,w=t.sparkMethod(),r.abrupt("return",new Promise(function(){var e=Object(s["default"])(c.a.mark((function e(t,r){var a,u;return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return u=function(){return u=Object(s["default"])(c.a.mark((function e(){var s,u,o,f,h,x;return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,s=i[b],e.next=4,g.slice(s);case 4:return u=e.sent,o=u.byteLength,k+=o,p+=Number.isNaN(o)?0:o,e.next=10,n.dealLifecycle("reading",{name:l,status:d["b"].reading,current:p,total:m});case 10:return f=!1,h=!1,x=r,++b<v?f=a:(n.setState(l,{file:{size:k}}),h=t),e.next=16,w(u,{next:f,done:h,error:x});case 16:e.next=21;break;case 18:e.prev=18,e.t0=e["catch"](0),r(e.t0);case 21:case"end":return e.stop()}}),e,null,[[0,18]])}))),u.apply(this,arguments)},a=function(){return u.apply(this,arguments)},h.file.isParseIgnore()&&(w=o["noop"]),e.next=5,a();case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()));case 10:case"end":return r.stop()}}),r)})))()}};class Z extends B{constructor(e){super(e),this.tasks=[]}clean(e){var t;t=e?[e]:this.tasks,t.forEach((e=>{N.worker_clean(e);var t=this.tasks.indexOf(e);~t&&this.tasks.splice(t,1)}))}addFile(e){var t=this;return Object(s["default"])(c.a.mark((function r(){return c.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t.tasks.includes(e)||t.tasks.push(e),r.abrupt("return",t.start(e).then((r=>{if(!r)return null;var n=N.getProcess(e),i=t.getState(null===n||void 0===n?void 0:n.task),s=Object(a["default"])(i,2),u=s[1];return t.setState(u.symbol,{file:{md5:r}}),r})));case 2:case"end":return r.stop()}}),r)})))()}start(e){var t=this;return Object(s["default"])(c.a.mark((function r(){var n,i,s,u,l,f,h;return c.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(n=N.getProcess(e),n){r.next=3;break}return r.abrupt("return",t.clean(e));case 3:if(i=t.getState(n.task),s=Object(a["default"])(i,2),u=s[1],l=u.file.md5,!u.tool.file.isParseIgnoreConfig()){r.next=7;break}return r.abrupt("return",Promise.resolve(Object(o["uniqueId"])("ignore-prefix-md5")));case 7:if(!u.tool.file.isMd5(l)){r.next=9;break}return r.abrupt("return",Promise.resolve(l));case 9:return r.prev=9,r.next=12,t.dealLifecycle("beforeRead",{name:u.symbol,status:d["b"].reading});case 12:r.next=18;break;case 14:return r.prev=14,r.t0=r["catch"](9),console.warn(r.t0),r.abrupt("return",Promise.reject(r.t0));case 18:if(!t.hasReaderEmit()){r.next=20;break}return r.abrupt("return",new Promise(((e,r)=>{t.emit("reader",u,((t,n)=>{t?r(t):e(n),e(n)})),setTimeout((()=>{r("timeout")}),864e5)})));case 20:f=u.file.action,h=new V(t.context,e),r.t1=f,r.next=r.t1===d["a"].MD5?25:r.t1===d["a"].BASE64?26:r.t1===d["a"].BUFFER?27:r.t1===d["a"].FILE?28:29;break;case 25:return r.abrupt("return",t.GET_MD5(u,h));case 26:return r.abrupt("return",t.GET_BASE64_MD5(u,h));case 27:return r.abrupt("return",t.GET_BUFFER_MD5(u,h));case 28:return r.abrupt("return",t.GET_FILE_MD5(u,h));case 29:return r.abrupt("break",30);case 30:case"end":return r.stop()}}),r,null,[[9,14]])})))()}GET_MD5(e,t){return Object(s["default"])(c.a.mark((function r(){return c.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.abrupt("return",t.files(e));case 1:case"end":return r.stop()}}),r)})))()}GET_BASE64_MD5(e,t){return Object(s["default"])(c.a.mark((function r(){return c.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.abrupt("return",t.base64(e));case 1:case"end":return r.stop()}}),r)})))()}GET_BUFFER_MD5(e,t){return Object(s["default"])(c.a.mark((function r(){return c.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.abrupt("return",t.arraybuffer(e));case 1:case"end":return r.stop()}}),r)})))()}GET_FILE_MD5(e,t){return Object(s["default"])(c.a.mark((function r(){return c.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.abrupt("return",t.blob(e));case 1:case"end":return r.stop()}}),r)})))()}}var J=Z;class $ extends J{constructor(e){super(e)}addFile(e){var t=this;return Object(s["default"])(c.a.mark((function r(){return c.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t.tasks.includes(e)||t.tasks.push(e),r.abrupt("return",t.start(e));case 2:case"end":return r.stop()}}),r)})))()}start(e){var t=this;return Object(s["default"])(c.a.mark((function r(){var n,i,s,u;return c.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(n=N.getProcess(e),n){r.next=4;break}return t.clean(e),r.abrupt("return",Promise.reject("process not found"));case 4:return i=t.getState(n.task),s=Object(a["default"])(i,2),u=s[1],r.next=7,t.exitDataFn(u).then((e=>t.uploadFn(e,n))).then((e=>Promise.all([e,t.dealLifecycle("afterComplete",{success:!0,name:u.symbol,status:d["b"].fulfilled})]))).then((e=>e[0]));case 7:case"end":return r.stop()}}),r)})))()}getUnCompleteIndexes(e,t,r){var n,a=t||{data:void 0},i=a.data,s=e.file.size,u=e.config.chunkSize,c=e.symbol,o=Math.ceil(s/u),l=[],f=e=>"string"===typeof e?parseInt(e):Number(null===e||void 0===e?void 0:e.toFixed(0));if(Array.isArray(i))l=i.filter((e=>{var t=f(e);return!Number.isNaN(t)&&o>t}));else{var d=f(i);if(Number.isNaN(d)||d>s||d<0){if(!r)throw new Error("upload function response data is not valid");console.warn("exit function response data is not valid"),d=0}var h=d/u;l=d==s?[]:Math.round(h)==h?new Array(o-h).fill(0).map(((e,t)=>t+h)):new Array(o).fill(0).map(((e,t)=>t))}return this.setState(c,{file:{unComplete:l},process:{complete:o-((null===(n=l)||void 0===n?void 0:n.length)||o),current:0}}),l}exitDataFn(e){var t=this;return Object(s["default"])(c.a.mark((function r(){var n,a,i,s,u,o,l,f,h,p,v,b;return c.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.symbol,a=e.config.chunkSize,i=e.file,s=i.size,u=i.mime,o=i.name,l=i.md5,f=e.request.exitDataFn,h=e.tool,p={data:0},r.next=4,t.dealLifecycle("beforeCheck",{name:n,status:d["b"].uploading});case 4:if(h.file.isExitFnEmit()){r.next=6;break}return r.abrupt("return",p);case 6:return v={filename:null!==o&&void 0!==o?o:"",md5:l,suffix:u||"",size:s,chunkSize:a,chunksLength:Math.ceil(s/a)},r.next=9,f(v,n,e);case 9:return b=r.sent,t.setRequestCache("exitDataFn",b,e),r.abrupt("return",b);case 12:case"end":return r.stop()}}),r)})))()}uploadFn(e,t){var r=this;return Object(s["default"])(c.a.mark((function n(){var s,u,o,l,f,h,p,v,b,g;return c.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return s=r.getState(null===t||void 0===t?void 0:t.task),u=Object(a["default"])(s,2),o=u[1],l=r.getUnCompleteIndexes(o,e,!0),f=!l.length,h=o,p=h.symbol,n.next=6,r.dealLifecycle("afterCheck",{name:p,status:d["b"].uploading,isExists:f});case 6:if(v={name:p,status:d["b"].uploading,isExists:f},f){n.next=11;break}return n.abrupt("return",r.upload(t).then((()=>r.dealLifecycle("beforeComplete",v))).then((()=>r.completeFn({task:o,response:e}))));case 11:return b=e||{},b.data,g=Object(i["a"])(b,["data"]),n.abrupt("return",r.dealLifecycle("beforeComplete",v).then((e=>g)));case 13:case"end":return n.stop()}}),n)})))()}upload(e){var t=this;return Object(s["default"])(c.a.mark((function r(){var n,i,u,o,l,f,h,p,v,b,g,m,k,w,x,y,j,O,E,C,S,T,A;return c.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.task,i=e.worker,u=t.getState(n),o=Object(a["default"])(u,2),l=o[1],f=l,h=f.symbol,p=f.file,v=p.md5,b=p.unComplete,g=p.size,m=p.file,k=p._cp_,w=p.chunks,x=f.request.uploadFn,y=f.config.chunkSize,j=[...b],O=Math.ceil(g/y),r.next=7,null===i||void 0===i?void 0:i.cacheExists(O);case 7:C=r.sent,C?E=function(){var e=Object(s["default"])(c.a.mark((function e(t){return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",i.getChunk(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}():(S=new Y(t.context,l),E=k?function(){var e=Object(s["default"])(c.a.mark((function e(t){var r;return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,S.slice(w[t]);case 2:return r=e.sent,e.abrupt("return","undefined"===typeof Blob?r:new Blob([r]));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}():function(){var e=Object(s["default"])(c.a.mark((function e(t){var r,n,a;return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=t*y,n=r+y,n=n>=g?g:n,e.next=5,S.slice(m,r,n);case 5:return a=e.sent,e.abrupt("return","undefined"===typeof Blob?a:new Blob([a]));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),T=0;case 10:if(!(T<O)){r.next=17;break}if(A=j.indexOf(T),!~A){r.next=14;break}return r.delegateYield(c.a.mark((function e(){var r,n,a,i;return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return j.splice(A,1),e.next=3,E(T);case 3:return r=e.sent,n={file:r,md5:v,index:T},a=void 0,"undefined"!==typeof FormData?(a=new FormData,Object.keys(n).forEach((e=>{a.append(e,n[e])}))):a=n,e.next=9,x(a,h,l);case 9:return i=e.sent,t.setRequestCache("uploadFn",i,l),e.next=13,t.dealLifecycle("uploading",{name:h,status:d["b"].uploading,current:T+1,total:O,complete:O-j.length});case 13:i&&(j=t.getUnCompleteIndexes(l,i,!1)),t.setState(h,{file:{unComplete:j}});case 15:case"end":return e.stop()}}),e)}))(),"t0",14);case 14:T++,r.next=10;break;case 17:return r.abrupt("return",Promise.resolve());case 18:case"end":return r.stop()}}),r)})))()}completeFn(e){var t=this;return Object(s["default"])(c.a.mark((function r(){var n,a,i,s,u,o;return c.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(n=e.task,a=e.response,i=n.file.md5,s=n.symbol,u=n.request.completeFn,"function"!==typeof u){r.next=8;break}return r.next=5,u({name:s,md5:i},s,n);case 5:return o=r.sent,t.setRequestCache("completeFn",o,n),r.abrupt("return",o);case 8:return r.abrupt("return",a);case 9:case"end":return r.stop()}}),r)})))()}setRequestCache(e,t,r){r&&r.config.requestCache&&("object"!==typeof r.config.requestCache||r.config.requestCache[e])&&this.setState(r.symbol,{tool:{requestCache:{[e]:"uploadFn"===e?[...r.tool.requestCache.uploadFn||[],t]:t}}})}}class K extends f.a{static install(e,t){var r;K.plugins||(K.plugins={}),K.plugins[e]||(K.plugins[e]=[]);var n,a,i=(null===(r=K.plugins[e])||void 0===r?void 0:r.findIndex((e=>e===t)))||-1;~i?null===(n=K.plugins[e])||void 0===n||n.splice(i,1,t):null===(a=K.plugins[e])||void 0===a||a.push(t)}static uninstall(e,t){var r;K.plugins&&K.plugins[e]&&(t||(K.plugins[e]=[]),K.plugins[e]=(null===(r=K.plugins[e])||void 0===r?void 0:r.filter((e=>e!==t)))||[])}static file2Blob(e,t){return Object(s["default"])(c.a.mark((function r(){var n;return c.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(e instanceof File){r.next=2;break}return r.abrupt("return",e);case 2:return r.next=4,K.file2arraybuffer(e);case 4:return n=r.sent,r.abrupt("return",new Blob([n],t));case 6:case"end":return r.stop()}}),r)})))()}static blob2file(e,t,r){return e instanceof Blob?new File([e],t,r):e}static file2arraybuffer(e){return Object(s["default"])(c.a.mark((function t(){return c.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e instanceof File){t.next=2;break}return t.abrupt("return",e);case 2:return t.abrupt("return",K.blob2arraybuffer(e.slice(0,e.size)));case 3:case"end":return t.stop()}}),t)})))()}static blob2arraybuffer(e){return e instanceof Blob?new Promise(((t,r)=>{var n=new FileReader;n.onload=function(e){var r;t(null===(r=e.target)||void 0===r?void 0:r.result)},n.onerror=r,n.readAsArrayBuffer(e)})):e}static file2base64(e){return Object(s["default"])(c.a.mark((function t(){var r;return c.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e instanceof File){t.next=2;break}return t.abrupt("return",e);case 2:return t.next=4,K.file2arraybuffer(e);case 4:return r=t.sent,t.abrupt("return",K.btoa(r));case 6:case"end":return t.stop()}}),t)})))()}static blob2base64(e){return Object(s["default"])(c.a.mark((function t(){var r;return c.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e instanceof Blob){t.next=2;break}return t.abrupt("return",e);case 2:return t.next=4,K.blob2arraybuffer(e);case 4:return r=t.sent,t.abrupt("return",K.btoa(r));case 6:case"end":return t.stop()}}),t)})))()}static arraybuffer2file(e,t,r){return e instanceof ArrayBuffer?new File([e],t,r):e}static arraybuffer2blob(e,t){return e instanceof ArrayBuffer?new Blob([e],t):e}static base642blob(e,t){if(!k(e))return e;var r=K.atob(e);return new Blob([r],t)}static base642file(e,t,r){if(!k(e))return e;var n=K.atob(e);return new File([n],t,r)}get defaultConfig(){return this._defaultConfig}set defaultConfig(e){var t=e.internal,r=Object(i["a"])(e,["internal"]);t&&(this._defaultConfig=Object(o["merge"])({},this._defaultConfig,r))}constructor(e){var t;if(super(),t=this,this.lifecycle=new P,this.emitter=new T(this),this.reader=void 0,this.uploader=void 0,this.workerPool=void 0,this._defaultConfig=Object(d["c"])(),this.LIFECYCLE_EMIT=function(){var e=Object(s["default"])(c.a.mark((function e(r,i){var s,u,o,l,f,h,p,v,b,g,m,k,w,x,y,j;return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(s=i.name,u=i.status,o=t.emitter.getTask(s),l=Object(a["default"])(o,2),f=l[1],h=f,p=h.symbol,v={},f){e.next=6;break}return e.abrupt("return",Promise.reject("not found the task"));case 6:return b=!1,e.prev=7,t.emitter.setState(s,{status:u}),e.next=11,t.lifecycle.emit(r,Object(n["a"])(Object(n["a"])({},i),{},{task:f}));case 11:g=e.sent,g instanceof Object&&t.emitter.setState(s,g),e.next=18;break;case 15:e.prev=15,e.t0=e["catch"](7),b=e.t0;case 18:if(e.prev=18,k=t.getStatus(s),k!==d["b"].stopping&&k!==d["b"].cancel){e.next=32;break}return k===d["b"].stopping&&(b="stop",w="afterStop"),k===d["b"].cancel&&(b="cancel",w="afterCancel"),e.prev=23,x=t.watch(p),y=Object(a["default"])(x,1),j=y[0],e.next=27,t.lifecycle.emit(w,{name:p,status:k,current:null===j||void 0===j?void 0:j.current,task:f});case 27:e.next=31;break;case 29:e.prev=29,e.t1=e["catch"](23);case 31:v.status=k;case 32:if(t.emitter.setState(s,v),!b){e.next=37;break}return e.abrupt("return",Promise.reject(b));case 37:if((null===(m=g)||void 0===m?void 0:m.status)!==d["b"].stopping){e.next=39;break}return e.abrupt("return",!1);case 39:return e.finish(18);case 40:case"end":return e.stop()}}),e,null,[[7,15,18,40],[23,29]])})));return function(t,r){return e.apply(this,arguments)}}(),!K.isSupport())throw new Error("this tool must be support for the ArrayBuffer");this.reader=new J(this),this.uploader=new $(this),this.lifecycle.onWithObject((null===e||void 0===e?void 0:e.lifecycle)||{}),this.defaultConfig=Object(d["c"])(Object(o["merge"])({},this.defaultConfig,(null===e||void 0===e?void 0:e.config)||{},{internal:!0})),this.workerPool=new N,this.pluginsCall(null===e||void 0===e?void 0:e.ignores)}pluginsCall(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(this.removeAllListeners(),K.plugins){var t=Object.keys(K.plugins);t.forEach((t=>{if(!e.includes(t)){var r=K.plugins[t]||[],n=function(){var e=Object(s["default"])(c.a.mark((function e(){var t,n,i,s,u,o,l,f,d,h,p,v,b,g,m=arguments;return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:for(t=m.length,n=new Array(t),i=0;i<t;i++)n[i]=m[i];s=n.slice(0,-1),u=n.slice(-1),o=Object(a["default"])(u,1),l=o[0],f=void 0,d=0;case 5:if(!(d<r.length)){e.next=21;break}return h=r[d],e.next=9,E(h)(...s,f);case 9:if(p=e.sent,v=Object(a["default"])(p,2),b=v[0],g=v[1],f=g,!b){e.next=18;break}return console.error(b),l(b,null),e.abrupt("return");case 18:d++,e.next=5;break;case 21:l(null,f);case 22:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();this.on(t,n,this),this.once(t,this.off.bind(this,t,n),this)}}))}}dispose(){var e=this;return Object(s["default"])(c.a.mark((function t(){var r,n,a,i,s,u,o;return c.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:for(a=e.emitter.getTasks(),i=N.getProcesses(),s=function(t){var r=a[t],n=r.symbol,s=r.status,u=i.find((e=>e.task==n));s>=d["b"].waiting&&u&&e.cancel(n)},u=0;u<a.length;u++)s(u);o=[];while(!N.queueIsEmpty())o.push(e.workerPool.dequeue());o.forEach((t=>{if(t){var r=a.find((e=>e.symbol==t));r||e.workerPool.enqueue(t)}})),null===(r=e.emitter)||void 0===r||r.clean(),null===(n=e.reader)||void 0===n||n.clean(),e.lifecycle.init();case 10:case"end":return t.stop()}}),t)})))()}static isSupport(){return"undefined"!==typeof ArrayBuffer}add(){return this.emitter.add(...arguments)}deal(){var e=this.emitter.deal(...arguments);return e.forEach((e=>{var t=e.lifecycle,r=e.symbol;this.lifecycle.onWithObject(t||{},r)})),this.workerPool.enqueue(...e.map((e=>e.symbol))).then((e=>this.performanceTask(e))),e.map((e=>e.symbol))}start(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.forEach((e=>this.emitter.statusChange(d["b"].pending,e))),this.deal(...t)}cancelAdd(){return this.emitter.cancelAdd(...arguments)}stop(){return this.emitter.stop(...arguments)}cancel(){return this.emitter.cancel(...arguments)}resumeTask(){return this.emitter.resumeTask(...arguments)}uploading(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var i=t.map((e=>{var t;if(e.symbol){var r=this.resumeTask(e),i=Object(a["default"])(r,1);t=i[0]}else{var s=Object(n["a"])(Object(n["a"])({},e),{},{_cp_:!0}),u=this.add(s),c=Object(a["default"])(u,1);t=c[0]}return t})).filter((e=>!!e));return this.deal(...i),i}upload(){var e=this.add(...arguments);return this.deal(...e),e}watch(){for(var e=this.emitter.tasks,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return r.map((t=>{var r=e.find((e=>e.symbol==t));if(!r)return null;var n=r.process,a=n.current,i=n.complete,s=n.total,u=r.status;return{error:null,name:t,status:u,complete:i,progress:parseFloat((i/s).toFixed(4))||0,total:s||0,current:a||0}}))}getTask(e){var t=this.emitter.getTask(e),r=Object(a["default"])(t,2),n=r[1];return n}getOriginFile(e){var t,r=this.getTask(e);return(null===r||void 0===r||null===(t=r.file)||void 0===t?void 0:t.file)||null}getStatus(e){var t,r=this.getTask(e);return null!==(t=null===r||void 0===r?void 0:r.status)&&void 0!==t?t:null}getRequestCache(e){var t=this.getTask(e);return null===t||void 0===t?void 0:t.tool.requestCache}dealNextTasks(){var e=this;return Object(s["default"])(c.a.mark((function t(){return c.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",e.workerPool.enqueue().then((t=>e.performanceTask(t))));case 1:case"end":return t.stop()}}),t)})))()}performanceTask(e){var t=this;return Object(s["default"])(c.a.mark((function r(){return c.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.abrupt("return",y(e.map(function(){var e=Object(s["default"])(c.a.mark((function e(r){var n,i,u,l,f,h,p,v,b,g,m,k;return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=N.getProcess(r),i=n.task,u=t.emitter.getTask(i),l=Object(a["default"])(u,2),f=l[1],h=f,p=h.request.callback,v=h.symbol,b=h.config.retry,g=h.lifecycle,m=void 0===g?{}:g,k="function"===typeof p?p:o["noop"],e.abrupt("return",t.reader.addFile(r).then((e=>t.uploader.addFile(r))).then((e=>({remove:!0,name:v,error:null,retry:!1}))).catch(function(){var e=Object(s["default"])(c.a.mark((function e(r){var n,a,i,s;return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(console.error(r),n={error:r,name:v,remove:!0,retry:!1},a=f,i=a.status,i===d["b"].stopping||i===d["b"].cancel){e.next=22;break}if(t.emitter.setState(v,{status:d["b"].rejected}),n.retry=(null===b||void 0===b?void 0:b.times)>0,!n.retry){e.next=20;break}return e.prev=7,e.next=10,t.LIFECYCLE_EMIT("retry",{name:v,status:d["b"].pending,rest:b.times-1});case 10:s=e.sent,n.retry=null===s||void 0===s||s,e.next=17;break;case 14:e.prev=14,e.t0=e["catch"](7),n.retry=!1;case 17:return e.prev=17,n.remove=!n.retry,e.finish(17);case 20:e.next=23;break;case 22:i===d["b"].stopping&&(n.remove=!1);case 23:return e.abrupt("return",n);case 24:case"end":return e.stop()}}),e,null,[[7,14,17,20]])})));return function(t){return e.apply(this,arguments)}}()).then(function(){var e=Object(s["default"])(c.a.mark((function e(n){var a,i,s,u,l,f;return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(N.worker_clean(r),a=n.error,i=n.name,s=n.remove,u=n.retry,l=a?{error:a}:null,t.lifecycle.onWithObject(m,i,"off"),!s){e.next=10;break}return t.emitter.off(v),k(l,i),e.abrupt("return",t.dealNextTasks());case 10:if(!u){e.next=15;break}f=t.deal(v),f.length||(t.emitter.off(v),k(Object(o["merge"])({},l,{error:{error:null===l||void 0===l?void 0:l.error,description:"unknown error"}}),i)),e.next=17;break;case 15:return k(l,i),e.abrupt("return",t.dealNextTasks());case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((e=>{console.error(e),k(e,v)})));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())).catch((e=>{console.error(e)})));case 1:case"end":return r.stop()}}),r)})))()}}K.plugins={},K.btoa=O,K.atob=j},bpEk:function(e,t,r){"use strict";var n=r("9og8"),a=r("WmNS"),i=r.n(a),s=r("QG5f");class u extends s["a"]{static setOptions(e){var t=e.arrayBufferToBase64,r=e.base64ToArrayBuffer;u.btoa=t,u.atob=r}constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(e),s["a"].install("slicer",function(){var e=Object(n["default"])(i.a.mark((function e(t,r,n,a){return i.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("string"!==typeof a){e.next=4;break}return e.abrupt("return",u.atob(a));case 4:if(!(a instanceof ArrayBuffer)){e.next=8;break}return e.abrupt("return",a);case 8:return e.abrupt("return",Promise.reject("can not slice this type file"));case 9:case"end":return e.stop()}}),e)})));return function(t,r,n,a){return e.apply(this,arguments)}}()),this.pluginsCall(null===e||void 0===e?void 0:e.ignores)}}t["a"]=u},"f/wd":function(e,t,r){"use strict";r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return c})),r.d(t,"a",(function(){return a}));var n,a,i=r("LvDl"),s=5242880;(function(e){e[e["pending"]=0]="pending",e[e["waiting"]=1]="waiting",e[e["reading"]=2]="reading",e[e["uploading"]=3]="uploading",e[e["fulfilled"]=4]="fulfilled",e[e["rejected"]=-3]="rejected",e[e["cancel"]=-2]="cancel",e[e["stopping"]=-1]="stopping"})(n||(n={})),function(e){e[e["MD5"]=0]="MD5",e[e["FILE"]=1]="FILE",e[e["BUFFER"]=2]="BUFFER",e[e["BASE64"]=3]="BASE64"}(a||(a={}));var u={chunkSize:s,parseIgnore:!1,requestCache:!1};function c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object(i["merge"])({},u,e);return!0===t.requestCache&&(t.requestCache={exitDataFn:!0,uploadFn:!0,completeFn:!0}),t}Object.seal(u)}}]);